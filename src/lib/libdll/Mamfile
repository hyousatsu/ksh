note *
note * This build file is in the Make Abstract Machine (MAM) language. It was
note * first generated by nmake, but in the ksh 93u+m distribution we maintain
note * it manually because nmake had too many problems to keep using. The
note * Mamfiles are processed by mamake (src/cmd/INIT/mamake.c); we added
note * indentation to improve readability. The language is documented in
note * src/cmd/INIT/README-mamake.md.
note *
setv MAMAKE_STRICT
setv INSTALLROOT ../../..
setv PACKAGE_ast_INCLUDE ${INSTALLROOT}/include/ast
setv AR ${mam_cc_AR} ${mam_cc_AR_ARFLAGS}
setv CC cc
setv mam_cc_FLAGS ${mam_cc_DLL}
setv CCFLAGS ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${mam_cc_OPTIMIZE}?}
setv IFFEFLAGS
setv LDFLAGS
make install virtual
	make dll virtual
		make dll.req
			prev ${INSTALLROOT}/bin/mkreq
			exec - mkreq ${CC} ${mam_cc_FLAGS} ${CCFLAGS} : ${LDFLAGS} : dll dl dld ast
		done
		make libdll.a
			prev dll.req
			make dlfcn.o
				make dlfcn.c
					make dlldefs.h implicit
						make FEATURE/dll
							prev features/dll
							bind -ldl dontcare
							bind -last
							exec - iffe ${IFFEFLAGS} -v -c "${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS}" ref ${mam_cc_L+-L.} ${mam_cc_L+-L${INSTALLROOT}/lib} -I${PACKAGE_ast_INCLUDE} -I${INSTALLROOT}/include ${mam_libdl} ${mam_libast} : run features/dll
						done
						exec - ${STDCP} -f FEATURE/dll dlldefs.h
					done
				done dlfcn.c
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dlfcn.c
			done dlfcn.o
			make dllopen.o
				make dllopen.c
					make dlllib.h implicit
						prev dlldefs.h
					done
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllopen.c
			done
			make dllfind.o
				make dllfind.c
					prev dlldefs.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllfind.c
			done
			make dllplug.o
				make dllplug.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllplug.c
			done
			make dll_lib.o
				make dll_lib.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dll_lib.c
			done
			make dllnext.o
				make dllnext.c
					prev dlldefs.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllnext.c
			done
			make dlllook.o
				make dlllook.c
					prev dlldefs.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dlllook.c
			done
			make dllscan.o
				make dllscan.c
					prev dlldefs.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${CCFLAGS.FORCE}?} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllscan.c
			done
			make dllcheck.o
				make dllcheck.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllcheck.c
			done
			make dllerror.o
				make dllerror.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c dllerror.c
			done
			exec - ${AR} rc libdll.a dlfcn.o dllopen.o dllfind.o dllplug.o dll_lib.o dllnext.o dlllook.o dllscan.o dllcheck.o dllerror.o
			exec - (ranlib libdll.a) >/dev/null 2>&1 || true
		done libdll.a
	done dll
	prev libdll.a
	make ${INSTALLROOT}/lib
		exec - mkdir -p ${INSTALLROOT}/lib
	done
	make ${INSTALLROOT}/lib/libdll.a
		prev libdll.a
		exec - ${STDCP} -f libdll.a ${INSTALLROOT}/lib/libdll.a
		exec - (ranlib ${INSTALLROOT}/lib/libdll.a) >/dev/null 2>&1 || true
	done
	make ${INSTALLROOT}/lib/lib
		exec - mkdir -p ${INSTALLROOT}/lib/lib
	done
	make ${INSTALLROOT}/lib/lib/dll
		prev dll.req
		exec - ${STDCP} -f dll.req ${INSTALLROOT}/lib/lib/dll
	done
	make ${PACKAGE_ast_INCLUDE}/dlldefs.h
		prev dlldefs.h
		exec - ${STDCP} -f dlldefs.h ${PACKAGE_ast_INCLUDE}/dlldefs.h
	done
done install
make test dontcare virtual
done test
