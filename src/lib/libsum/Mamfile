note *
note * This build file is in the Make Abstract Machine (MAM) language. It was
note * first generated by nmake, but in the ksh 93u+m distribution we maintain
note * it manually because nmake had too many problems to keep using. The
note * Mamfiles are processed by mamake (src/cmd/INIT/mamake.c); we added
note * indentation to improve readability. The language is documented in
note * src/cmd/INIT/README-mamake.md.
note *
setv MAMAKE_STRICT
setv INSTALLROOT ../../..
setv PACKAGE_ast_INCLUDE ${INSTALLROOT}/include/ast
setv AR ${mam_cc_AR} ${mam_cc_AR_ARFLAGS}
setv CC cc
setv mam_cc_FLAGS ${mam_cc_PIC}
setv CCFLAGS ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${mam_cc_OPTIMIZE}?}
setv IFFEFLAGS
setv LDFLAGS
make install virtual
	make sum virtual
		make sum.req
			prev ${INSTALLROOT}/bin/mkreq
			exec - mkreq ${CC} ${mam_cc_FLAGS} ${CCFLAGS} : ${LDFLAGS} : sum md ast
		done
		make libsum.a
			prev sum.req
			make sumlib.o
				make sumlib.c
					prev sum-sha2.c implicit dontcare
					prev sum-sha1.c implicit dontcare
					prev sum-md5.c implicit dontcare
					prev sum-lmd.c implicit dontcare
					prev sum-prng.c implicit
					prev sum-bsd.c implicit
					prev sum-ast4.c implicit
					make FEATURE/sum implicit
						prev features/sum
						bind -last
						exec - iffe ${IFFEFLAGS} -v -c "${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS}" ref ${mam_cc_L+-L${INSTALLROOT}/lib} -I${PACKAGE_ast_INCLUDE} -I${INSTALLROOT}/include ${mam_libast} : run features/sum
					done
					prev sum.h implicit
					prev sum-att.c implicit
					prev sum-crc.c implicit
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -c sumlib.c
			done sumlib.o
			exec - ${AR} rc libsum.a sumlib.o
			exec - (ranlib libsum.a) >/dev/null 2>&1 || true
		done libsum.a
	done sum
	prev libsum.a
	make ${INSTALLROOT}/lib
		exec - mkdir -p ${INSTALLROOT}/lib
	done
	make ${INSTALLROOT}/lib/libsum.a
		prev libsum.a
		exec - ${STDCP} -f libsum.a ${INSTALLROOT}/lib/libsum.a
		exec - (ranlib ${INSTALLROOT}/lib/libsum.a) >/dev/null 2>&1 || true
	done
	make ${INSTALLROOT}/lib/lib
		exec - mkdir -p ${INSTALLROOT}/lib/lib
	done
	make ${INSTALLROOT}/lib/lib/sum
		prev sum.req
		exec - ${STDCP} -f sum.req ${INSTALLROOT}/lib/lib/sum
	done
	make ${PACKAGE_ast_INCLUDE}/sum.h
		prev sum.h
		exec - ${STDCP} -f sum.h ${PACKAGE_ast_INCLUDE}/sum.h
	done
done install
make test dontcare virtual
done test
